<template>
  <div class="cube-base-layout">
    <div class="cube-base-layout__nav">
      <div class="cube-nav" :style="{ 'background-color': themeColor }">
        <!-- LOGO -->
        <div>
          <slot name="logo">
            <a
              style="cursor: pointer; position: relative; top: 2px; left: -8px"
              :href="dbBaseUrl"
              target="_blank"
            >
              <svg viewBox="0 0 2925 1024" width="120" height="64">
                <path
                  d="M876.251429 377.173333l-248.685715 115.321905c-17.554286 8.289524-29.013333 25.84381-29.013333 45.348572v306.468571c0 18.529524 19.260952 30.96381 36.083809 23.161905l248.685715-115.321905c17.554286-8.289524 29.013333-25.84381 29.013333-45.348571V400.335238c0-18.529524-19.260952-30.96381-36.083809-23.161905z m-114.834286 291.596191c20.48-9.99619 33.401905-35.352381 33.401905-35.352381l8.045714 4.388571c1.462857 0.731429 1.706667 3.169524 0.487619 5.36381-10.24 18.041905-24.868571 33.401905-41.20381 40.96-30.47619 14.140952-55.344762-3.657143-55.344761-39.984762 0-36.08381 24.868571-77.04381 55.344761-91.184762 16.335238-7.558095 30.96381-5.851429 41.20381 2.681905 1.219048 0.975238 0.975238 3.657143-0.487619 5.851428l-7.070476 10.24s-9.264762-12.190476-31.451429-2.194285c-19.748571 9.020952-41.691429 40.472381-42.422857 67.535238-0.487619 26.331429 17.798095 42.422857 39.497143 31.695238zM633.660952 288.182857l-30.963809-14.628571-52.419048 24.624762 30.476191 14.140952c9.020952 4.144762 32.670476 6.826667 49.980952-1.219048 20.48-9.508571 10.48381-19.260952 2.925714-22.918095z"
                  fill="#fff"
                ></path>
                <path
                  d="M872.838095 333.04381c21.455238-9.99619 21.455238-40.472381 0-50.468572L616.594286 162.620952a90.209524 90.209524 0 0 0-76.068572 0l-256.243809 119.954286c-21.455238 9.99619-21.455238 40.472381 0 50.468572l256.243809 119.954285a90.209524 90.209524 0 0 0 76.068572 0l256.243809-119.954285z m-306.224762-14.140953l-30.47619-14.140952-44.617143 20.967619-19.748571-9.264762 120.685714-56.32a12.190476 12.190476 0 0 1 9.264762 0l45.348571 21.211428c11.946667 5.607619 34.864762 21.942857-0.975238 38.521905-28.038095 13.165714-64.853333 5.851429-79.481905-0.975238zM528.822857 492.495238l-248.685714-116.297143c-16.822857-8.045714-36.327619 4.388571-36.327619 22.918095v306.468572c0 19.504762 11.215238 37.059048 28.769524 45.348571l248.685714 116.297143c16.822857 7.801905 36.327619-4.388571 36.327619-23.161905V537.84381c0-19.504762-11.215238-37.302857-28.769524-45.348572z m-73.142857 218.209524l-16.579048-7.801905v-92.891428l-38.521904 40.228571-38.521905-76.312381v88.259048c0 2.438095-1.706667 3.657143-3.657143 2.681904l-12.921905-6.095238V536.380952c0-2.681905 1.706667-3.900952 3.900953-2.925714l10.483809 4.876191 40.472381 81.188571 39.740952-41.691429c0.731429-0.731429 1.950476-0.975238 3.169524-0.243809l12.434286 5.851428v127.268572z"
                  fill="#fff"
                ></path>
                <path
                  d="M2122.361905 289.889524h153.843809v-22.430476c0-3.169524-2.681905-5.851429-5.851428-5.851429h-147.992381v-9.264762a7.070476 7.070476 0 0 0-7.070476-7.070476h-41.691429v16.335238h-147.992381c-3.169524 0-5.851429 2.681905-5.851429 5.851429v225.523809c0 28.038095-5.851429 45.104762-24.868571 50.712381-2.438095 0.731429-4.144762 2.925714-4.144762 5.607619v27.550476c51.687619 0 72.167619-39.740952 72.167619-83.626666V290.133333H2122.361905z"
                  fill="#fff"
                ></path>
                <path
                  d="M1986.31619 341.820952v24.380953c0 3.169524 2.681905 5.851429 5.851429 5.851428h27.062857v-24.380952c0-3.169524-2.681905-5.851429-5.851428-5.851429h-27.062858zM2084.08381 341.820952v24.380953c0 3.169524 2.681905 5.851429 5.851428 5.851428h27.062857v-24.380952c0-3.169524-2.681905-5.851429-5.851428-5.851429h-27.062857z"
                  fill="#fff"
                ></path>
                <path
                  d="M2121.142857 310.857143c0-3.169524-2.681905-5.851429-5.851428-5.851429H2072.380952a7.68 7.68 0 0 0-7.558095-7.070476h-35.59619v7.070476h-42.910477c-3.169524 0-5.851429 2.681905-5.851428 5.851429v22.430476h48.761905V365.714286c0 3.413333 2.925714 6.339048 6.339047 6.339047H2072.380952v-39.009523h48.761905v-22.186667zM2274.255238 310.857143c0-3.169524-2.681905-5.851429-5.851428-5.851429h-42.910477a7.68 7.68 0 0 0-7.558095-7.070476h-35.59619v7.070476H2140.647619a7.070476 7.070476 0 0 0-7.070476 7.070476v21.211429h48.761905V365.714286c0 3.413333 2.925714 6.339048 6.339047 6.339047h37.059048v-39.009523h48.761905v-22.186667z"
                  fill="#fff"
                ></path>
                <path
                  d="M2137.478095 341.820952v24.380953c0 3.169524 2.681905 5.851429 5.851429 5.851428h27.062857v-24.380952c0-3.169524-2.681905-5.851429-5.851429-5.851429h-27.062857zM2236.464762 341.820952v24.380953c0 3.169524 2.681905 5.851429 5.851428 5.851428h27.062858v-24.380952c0-3.169524-2.681905-5.851429-5.851429-5.851429h-27.062857zM2087.984762 498.834286h30.72v62.902857c0 8.045714 6.582857 14.628571 14.628571 14.628571h135.801905c8.045714 0 14.628571-6.582857 14.628572-14.628571v-36.571429H2250.361905c-3.413333 0-6.095238 2.681905-6.095238 6.095238v11.702858h-76.556191c-3.169524 0-5.851429-2.681905-5.851428-5.851429v-38.278095h93.379047c8.045714 0 14.628571-6.582857 14.628572-14.628572v-88.259047c0-3.169524-2.681905-5.851429-5.851429-5.851429h-161.401905v-6.095238a7.070476 7.070476 0 0 0-7.070476-7.070476h-41.691428V390.095238h-62.415239c-3.169524 0-5.851429 2.681905-5.851428 5.851429v102.887619h57.051428c-3.657143 27.550476-39.009524 45.83619-64.365714 49.005714-2.681905 0.24381-4.87619 2.925714-4.87619 5.851429v24.137142c59.733333 2.194286 101.668571-31.207619 114.590476-78.994285z m61.19619-41.691429h80.944762v13.409524h-80.944762v-13.409524z m80.944762-24.868571h-80.944762v-14.140953h80.944762v14.140953z m-124.342857-13.897143v14.140952h-81.432381v-14.140952h81.432381z m-81.188571 52.175238v-13.409524h81.432381v13.409524h-81.432381z"
                  fill="#fff"
                ></path>
                <path
                  d="M2188.190476 506.148571c-5.851429 0-10.727619 3.900952-11.946666 9.508572l-0.975239 4.144762-3.900952 16.091428h62.171429c1.950476 0 3.413333-1.706667 3.169523-3.657143l-3.169523-17.554285h-22.674286l0.975238 5.12h-12.190476l3.900952-13.653334h-15.36zM1108.601905 576.609524h349.135238V551.009524c0-3.169524-2.681905-5.851429-5.851429-5.851429H1148.586667c-3.169524 0-5.851429-2.681905-5.851429-5.851428V288.914286h309.881905V263.314286c0-3.169524-2.681905-5.851429-5.851429-5.851429H1100.068571c-3.169524 0-5.851429 2.681905-5.851428 5.851429v298.910476c0 7.801905 6.339048 14.384762 14.384762 14.384762z"
                  fill="#fff"
                ></path>
                <path
                  d="M1438.72 403.504762c0-3.169524-2.681905-5.851429-5.851429-5.851429h-104.350476v-37.546666h102.64381v-25.84381c0-3.169524-2.681905-5.851429-5.851429-5.851428h-164.083809l8.289523-13.897143h-56.563809l-14.140952 23.405714c-3.169524 5.36381-9.020952 8.533333-15.116191 8.533333h-0.975238c-3.169524 0-5.851429 2.681905-5.851429 5.851429v22.430476h28.281905c13.409524 0 26.087619-5.36381 35.352381-14.628571h39.009524v37.546666H1175.161905c-3.169524 0-5.851429 2.681905-5.851429 5.851429v25.843809h108.251429c-6.339048 27.794286-30.232381 59.977143-102.4 61.68381-3.169524 0-5.851429 2.681905-5.851429 5.851429v23.161904c69.973333 0 111.420952-18.773333 134.339048-43.885714 22.918095 25.112381 64.609524 43.885714 134.339047 43.885714v-23.405714c0-3.169524-2.438095-5.607619-5.607619-5.607619-72.411429-1.706667-96.304762-33.889524-102.643809-61.68381h108.251428v-25.843809zM1503.329524 550.765714v26.575238l130.438095-13.897142c2.925714-0.24381 5.12-2.925714 5.12-5.851429v-26.575238l-130.438095 13.897143c-2.925714 0.24381-5.12 2.681905-5.12 5.851428zM1845.638095 562.224762v-214.796191c0-3.169524-2.681905-5.851429-5.851428-5.851428h-106.544762l7.558095-12.921905h-56.56381l-12.434285 20.72381c-3.169524 5.36381-9.020952 8.533333-15.116191 8.533333h-0.975238c-3.169524 0-5.851429 2.681905-5.851428 5.851429v22.430476h28.281904c12.678095 0 24.380952-4.87619 33.401905-12.921905h85.089524v172.129524h-101.668571c-3.169524 0-5.607619 2.438095-5.60762 5.607619v25.843809h141.409524c8.289524-0.24381 14.872381-6.826667 14.872381-14.628571z"
                  fill="#fff"
                ></path>
                <path
                  d="M1720.07619 501.76h41.935239L1731.047619 420.08381a5.827048 5.827048 0 0 0-5.363809-3.657143h-41.935239l30.96381 81.67619c0.731429 2.194286 2.925714 3.657143 5.363809 3.657143zM1545.020952 301.348571v8.777143c0 3.169524 2.681905 5.851429 5.851429 5.851429h42.910476v-14.628572h161.401905v8.777143c0 3.169524 2.681905 5.851429 5.851428 5.851429h42.910477v-14.628572h52.419047V275.504762c0-3.169524-2.681905-5.851429-5.851428-5.851429h-46.567619v-18.529523c0-3.169524-2.681905-5.851429-5.851429-5.851429h-42.910476v24.624762h-161.401905v-18.773333c0-3.169524-2.681905-5.851429-5.851428-5.851429h-42.910477v24.624762h-46.811428c-3.169524 0-5.607619 2.438095-5.607619 5.607619v25.843809h52.419047zM1634.742857 328.655238h-65.340952l-63.878095 70.948572c-1.462857 1.706667-2.194286 3.657143-2.194286 5.851428v24.868572h65.340952l-63.878095 71.19238c-0.975238 0.975238-1.462857 2.438095-1.462857 3.900953v16.335238l130.681905-13.897143c2.925714-0.24381 5.12-2.925714 5.12-5.851428V475.428571l-50.468572 5.36381 49.005714-54.369524c0.975238-0.975238 1.462857-2.438095 1.462858-3.900952v-20.48h-70.217143l65.828571-73.386667zM2674.834286 269.897143h-150.430476v-17.310476a7.070476 7.070476 0 0 0-7.070477-7.070477h-41.691428v24.624762h-150.430476a7.070476 7.070476 0 0 0-7.070477 7.070477v24.380952h100.205715l-39.497143 191.634286c-5.607619 27.550476-28.281905 47.542857-49.249524 50.224762-2.925714 0.487619-5.12 2.925714-5.12 5.607619v27.550476c51.687619 0 91.91619-26.575238 101.180952-70.460953l23.405715-113.127619h155.062857l-15.847619 151.893334h-63.634286c-3.169524 0-5.607619 2.438095-5.607619 5.607619l-0.24381 25.843809h104.594286c7.558095 0 13.897143-5.851429 14.384762-13.165714l16.822857-185.782857a14.482286 14.482286 0 0 0-14.384762-15.847619H2455.893333l12.434286-60.220953H2681.904762v-24.380952a7.070476 7.070476 0 0 0-7.070476-7.070476zM1139.809524 662.918095h-41.447619c-2.438095 0-4.144762 1.950476-4.144762 4.144762v109.958095h17.798095V736.304762h27.794286c13.409524 0 37.302857-9.752381 37.302857-35.352381 0-32.670476-26.575238-38.034286-37.302857-38.034286z m0 60.708572h-27.794286v-47.786667h28.281905c6.826667 0 20.967619 4.87619 20.967619 23.893333 0 15.60381-13.409524 23.893333-21.455238 23.893334zM1337.539048 667.062857v43.885714h-50.956191v-48.274285h-13.897143c-2.438095 0-4.144762 1.950476-4.144762 4.144762v109.958095h17.798096v-53.638095h50.95619v53.638095h17.798095v-114.102857h-13.653333c-2.194286 0.24381-3.900952 2.194286-3.900952 4.388571zM1509.424762 662.918095h-12.434286c-1.706667 0-3.169524 0.975238-3.900952 2.438095l-46.32381 111.664762h18.773334l12.921904-31.939047h46.567619l12.921905 31.939047h18.773334l-46.32381-111.664762-0.975238-2.438095z m-25.84381 69.485715l18.285715-45.836191 18.285714 45.592381-36.571429 0.24381zM1929.99619 664.624762l-42.910476 53.881905-43.885714-55.588572h-11.459048c-2.438095 0-4.144762 1.950476-4.144762 4.144762v109.958095h13.897143c2.194286 0 4.144762-1.706667 4.144762-4.144762v-78.994285l41.691429 52.175238 41.447619-52.175238v83.139047h17.798095v-114.102857h-13.165714c-1.462857 0-2.681905 0.487619-3.413334 1.706667zM2313.020952 730.940952c0 8.533333-5.607619 31.695238-30.232381 31.695238-21.942857 0-30.232381-22.918095-30.232381-31.695238V663.161905h-18.041904V731.428571c0 12.921905 4.632381 24.137143 14.140952 33.401905 9.264762 9.264762 20.72381 13.897143 34.133333 13.897143 13.409524 0 24.624762-4.632381 34.133334-13.897143 9.264762-9.264762 14.140952-20.23619 14.140952-33.401905v-68.510476h-18.041905v68.022857zM2502.217143 725.820952c-1.462857-1.950476-3.169524-3.900952-5.12-5.607619-1.950476-1.706667-3.413333-2.681905-4.144762-3.169523a6.680381 6.680381 0 0 0-1.706667-0.975239l2.925715-2.194285c1.950476-1.462857 3.657143-4.144762 5.607619-8.045715 1.950476-3.900952 2.925714-8.045714 2.925714-12.678095 0-7.801905-5.851429-30.232381-33.401905-30.232381h-42.179047c-2.438095 0-4.144762 1.950476-4.144762 4.144762v109.958095h48.761904c10.48381 0 19.260952-3.169524 26.087619-9.752381 7.070476-6.826667 10.727619-14.872381 10.48381-24.137142 0-3.900952-0.975238-7.558095-2.438095-10.971429-1.462857-2.681905-2.438095-4.632381-3.657143-6.339048z m-61.68381-50.224762h28.525715c4.388571 0 15.60381 2.438095 15.603809 17.310477 0 13.653333-10.971429 17.310476-15.603809 17.310476h-28.525715v-34.620953z m30.96381 88.746667h-28.525714a2.438095 2.438095 0 0 1-2.438096-2.438095V724.114286h30.96381c5.36381 0 18.773333 5.36381 18.773333 19.504762 0 16.335238-13.653333 20.72381-18.773333 20.723809zM2677.76 764.342857h-60.220952v-38.521905h57.051428v-9.020952c0-2.438095-1.950476-4.144762-4.144762-4.144762h-52.662857v-36.815238h62.902857v-8.533333c0-2.438095-1.950476-4.144762-4.144762-4.144762h-72.167619c-2.438095 0-4.144762 1.950476-4.144762 4.144762v109.958095H2681.904762v-8.533333c0-2.438095-1.950476-4.388571-4.144762-4.388572zM1731.291429 696.07619c-0.975238-25.112381-20.72381-33.158095-34.864762-33.158095h-43.885715c-2.438095 0-4.144762 1.950476-4.144762 4.144762v109.958095h17.798096V731.428571h26.087619l25.35619 45.592381h18.773334L1710.08 731.428571s22.186667-7.801905 21.211429-35.352381z m-35.108572 22.674286h-30.232381v-43.154286h29.013334c7.801905 0 19.748571 4.87619 19.748571 20.48 0.24381 15.36-9.752381 22.674286-18.529524 22.674286zM2133.577143 747.27619s-12.678095 17.310476-35.596191 17.310477c-23.893333 0-43.154286-20.967619-43.154285-44.373334 0-23.405714 19.260952-44.373333 43.154285-44.373333 22.918095 0 35.59619 17.310476 35.596191 17.310476l9.020952-7.558095c1.462857-1.219048 1.706667-3.657143 0.487619-5.12-10.971429-11.946667-27.550476-19.017143-45.104762-19.017143-32.914286 0-59.733333 26.331429-59.733333 58.758095s26.819048 58.758095 59.733333 58.758096c17.798095 0 34.133333-7.070476 45.104762-19.017143 1.219048-1.462857 0.975238-3.657143-0.487619-5.12l-9.020952-7.558096z"
                  fill="#fff"
                ></path>
              </svg>
            </a>
          </slot>
        </div>
        <!-- 全局导航 -->
        <div class="cube-nav__gnav">
          <slot name="gnav"></slot>
        </div>
        <!-- 菜单 -->
        <ul class="cube-nav__menu">
          <li v-for="item in navs" :key="item.key">
            <span
              :class="{
                'menu-item': true,
                'menu-item--active': currentNavKey == item.key,
              }"
            >
              <!-- 导航名称-有下拉菜单 -->
              <span v-if="item.children && item.children.length">
                {{ item.title }}
              </span>
              <!-- 导航名称-无下拉菜单 -->
              <a v-else :href="item.link">{{ item.title }}</a>
            </span>
            <span v-if="item.children && item.children.length" class="icon">
              <svg viewBox="0 0 1024 1024" width="16" height="16">
                <path
                  d="M792.137143 338.139429a36.571429 36.571429 0 0 0-51.565714 3.584L513.462857 603.062857 283.282286 341.577143a36.425143 36.425143 0 1 0-54.784 48.201143L485.668571 683.300571l0.438858 0.292572a36.132571 36.132571 0 0 0 26.331428 11.264l0.512-0.146286 0.585143 0.146286a36.352 36.352 0 0 0 13.897143-2.925714 65.389714 65.389714 0 0 0 10.24-6.217143 36.571429 36.571429 0 0 0 3.364571-3.364572l254.537143-292.717714a36.571429 36.571429 0 0 0-3.510857-51.492571"
                  fill="#ffffff"
                ></path>
              </svg>
            </span>
            <!-- 下拉菜单 -->
            <ul v-if="item.children && item.children.length" class="sub-menus">
              <li v-for="(citem, cindex) in item.children" :key="cindex">
                <a
                  :href="citem.link"
                  :class="{ 'sub-menu--active': citem.key == currentNavKey }"
                >
                  {{ citem.title }}
                </a>
              </li>
            </ul>
          </li>
        </ul>
        <!-- 中英文 -->
        <div class="lan">
          <slot name="lan"></slot>
        </div>
        <!-- 头像 -->
        <UserAvatar
          :userInfo="state"
          :baseUrl="baseUrl"
          :dbBaseUrl="dbBaseUrl"
        />
        <!-- 退出 -->
        <div class="exit" @click="onLogout">
          {{ exitText }}
        </div>
      </div>
    </div>
    <div class="cube-base-layout__content">
      <slot></slot>
    </div>
  </div>
</template>

<script>
import { reactive, watch } from "vue";
import UserAvatar from "./UserAvatar";
import { USER_AUTH } from "./config";
export default {
  components: {
    UserAvatar,
  },
  props: {
    navs: {
      type: Array,
    },
    currentNavKey: {
      type: String,
    },
    themeColor: {
      type: String,
      default: "#1BBC9B",
    },
    userInfo: {
      type: Object,
    },
    baseUrl: {
      type: String,
    },
    dbBaseUrl: {
      type: String,
    },
    exitText: {
      type: String,
      default: "退出",
    },
  },
  setup(props, { emit }) {
    const state = reactive({
      isLogin: false,
      headImg: "",
      nickname: "",
      vipInfo: {},
    });
    function onLogout() {
      emit("logout");
    }
    watch(
      () => props.userInfo,
      (value) => {
        const { isLogin, headImg, nickname, vipInfo } = value || {};
        state.headImg = headImg;
        state.nickname = nickname;
        state.isLogin = isLogin;
        if (vipInfo) {
          state.vipInfo = USER_AUTH.map((item) => {
            const isAuth = item.children.some((citem) => vipInfo[citem.vip]);
            return {
              isAuth,
              ...item,
            };
          });
        }
      },
      {
        deep: true,
        immediate: true,
      }
    );
    return { state, onLogout };
  },
};
</script>

<style lang="less" scoped>
.cube-base-layout {
  padding-top: 64px;

  &__nav {
    height: 64px;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 9;

    .cube-nav {
      height: 64px;
      padding: 0 40px;
      display: flex;
      align-items: center;

      &__gnav {
        width: 16px;
        height: 16px;
        margin: 0 32px 0 20px;
      }

      &__menu {
        flex: 1;
        display: flex;
        .active {
          opacity: 1 !important;
        }
        & > li {
          padding: 0 16px 0 8px;
          margin-right: 16px;
          height: 64px;
          line-height: 64px;
          cursor: pointer;
          position: relative;
          .menu-item {
            font-size: 14px;
            font-weight: 400;
            color: #fff;
            opacity: 0.7;
            a {
              color: #fff;
            }
            &--active {
              opacity: 1;
              font-weight: 500;
            }
          }
          .icon {
            position: relative;
            top: 3px;
            margin-left: 4px;
          }
          .sub-menus {
            position: absolute;
            top: 64px;
            left: 0;
            right: 0;
            background-color: #fff;
            box-shadow: 0px 4px 16px 0px rgba(0, 0, 0, 0.12);
            border-radius: 4px;
            padding: 4px 0;
            display: none;
            transition: all 0.2s;

            & > li {
              font-size: 14px;
              font-weight: 400;
              color: #333333;
              padding: 0 8px;
              line-height: 32px;
              a {
                display: inline-block;
                color: #333;
                height: 22px;
                line-height: 22px;
              }

              &:last-child {
                margin-bottom: 0;
              }

              &:hover {
                a {
                  color: #1bbc9b;
                }
              }
            }

            .sub-menu--active {
              color: #1bbc9b;
            }
          }

          &:hover {
            .sub-menus {
              display: block;
            }
          }
        }
      }
      .lan {
      }
      .exit {
        font-size: 14px;
        font-weight: 400;
        color: #ffffff;
        margin-left: 10px;
        cursor: pointer;
      }
    }
  }

  &__content {
    min-height: calc(100vh - 64px);
  }
}
</style>